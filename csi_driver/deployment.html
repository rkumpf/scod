<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
    
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Hewlett Packard Enterprise">
  <link rel="shortcut icon" href="../img/favicon.ico">
    <meta property="og:title" content="HPE Storage Container Orchestrator Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Kubernetes and Docker integrations for HPE primary storage tailored for IT Ops, developers and partners. Including HPE 3PAR and Primera, HPE Cloud Volumes and HPE Nimble Storage."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://scod.hpedev.io"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://scod.hpedev.io/img/hpe-social-og-image01.jpg"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    
  <title>Deployment - HPE Storage Container Orchestrator Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../css/hpedev.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Deployment";
    var mkdocs_page_input_path = "csi_driver/deployment.md";
    var mkdocs_page_url = "/csi_driver/deployment.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-79554149-3', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> HPE Storage Container Orchestrator Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">WELCOME</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../welcome/index.html">Get started!</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">HPE CSI DRIVER FOR KUBERNETES</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="index.html">Overview</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="deployment.html">Deployment</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#overview">Overview</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#delivery_vehicles">Delivery vehicles</a></li>
        
            <li><a class="toctree-l4" href="#helm">Helm</a></li>
        
            <li><a class="toctree-l4" href="#operator">Operator</a></li>
        
            <li><a class="toctree-l4" href="#add_a_hpe_storage_backend">Add a HPE storage backend</a></li>
        
            <li><a class="toctree-l4" href="#adding_additional_backends">Adding additional backends</a></li>
        
            <li><a class="toctree-l4" href="#advanced_install">Advanced install</a></li>
        
            <li><a class="toctree-l4" href="#legacy_versions">Legacy versions</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="using.html">Using</a>
                </li>
                <li class="">
                    
    <a class="" href="monitor.html">Pod Monitor</a>
                </li>
                <li class="">
                    
    <a class="" href="diagnostics.html">Diagnostics</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">CONTAINER STORAGE PROVIDERS</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../container_storage_provider/hpe_3par_primera/index.html">HPE 3PAR and Primera</a>
                </li>
                <li class="">
                    
    <a class="" href="../container_storage_provider/hpe_nimble_storage/index.html">HPE Nimble Storage</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">LEGACY FLEXVOLUME DRIVER</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../flexvolume_driver/container_provider/index.html">Container Provider: Nimble and CV</a>
                </li>
                <li class="">
                    
    <a class="" href="../flexvolume_driver/hpe_3par_primera_installer/index.html">Ansible installer for 3PAR/Primera</a>
                </li>
                <li class="">
                    
    <a class="" href="../flexvolume_driver/dory/index.html">History: Dory and Doryd </a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">DOCKER VOLUME PLUGINS</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../docker_volume_plugins/hpe_cloud_volumes/index.html">HPE Cloud Volumes</a>
                </li>
                <li class="">
                    
    <a class="" href="../docker_volume_plugins/hpe_nimble_storage/index.html">HPE Nimble Storage</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">PARTNER ECOSYSTEMS</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../partners/rancher_labs/index.html">Rancher Labs</a>
                </li>
                <li class="">
                    
    <a class="" href="../partners/redhat_openshift/index.html">Red Hat OpenShift</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">LEARN</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../learn/containers101/index.html">Cloud-Native, Containers & DevOps</a>
                </li>
                <li class="">
                    
    <a class="" href="../learn/persistent_storage/index.html">Persistent Storage for Kubernetes</a>
                </li>
                <li class="">
                    
    <a class="" href="../learn/introduction_to_containers/index.html">For HPE partners:<br />&nbsp;&nbsp; Introduction to Containers</a>
                </li>
                <li class="">
                    
    <a class="" href="../learn/video_gallery/index.html">Video Gallery</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">COMMUNITY</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="https://developer.hpe.com">HPE Developer Community</a>
                </li>
                <li class="">
                    
    <a class="" href="https://slack.hpedev.io">Sign up to HPE DEV on Slack</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/hpe-storage/scod/issues/new?title=I have some feedback on SCOD">Got feedback?</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">EXTERNAL LINKS</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="https://github.com/hpe-storage/scod">SCOD on GitHub</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/hpe-storage">HPE Storage on GitHub</a>
                </li>
                <li class="">
                    
    <a class="" href="https://hpe.com/storage/containers">Storage for Containers on hpe.com</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">LEGAL</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../legal/contributing/index.html">Contributing</a>
                </li>
                <li class="">
                    
    <a class="" href="../legal/support/index.html">Support</a>
                </li>
                <li class="">
                    
    <a class="" href="../legal/license/index.html">License</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">HPE Storage Container Orchestrator Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>HPE CSI DRIVER FOR KUBERNETES &raquo;</li>
        
      
    
    <li>Deployment</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h1>
<p>The HPE CSI Driver is deployed by using industry standard means, either a Helm chart or an Operator. An "advanced install" from object configuration files is provided as reference for partners, OEMs and users wanting to perform customizations and their own packaging or deployment methodologies.</p>
<div class="toc">
<ul>
<li><a href="#overview">Overview</a><ul>
<li><a href="#delivery_vehicles">Delivery vehicles</a><ul>
<li><a href="#need_help_deciding">Need help deciding?</a></li>
</ul>
</li>
<li><a href="#helm">Helm</a></li>
<li><a href="#operator">Operator</a><ul>
<li><a href="#red_hat_openshift_container_platform">Red Hat OpenShift Container Platform</a></li>
<li><a href="#upstream_kubernetes_and_others">Upstream Kubernetes and others</a></li>
</ul>
</li>
<li><a href="#add_a_hpe_storage_backend">Add a HPE storage backend</a><ul>
<li><a href="#secret_parameters">Secret parameters</a></li>
</ul>
</li>
<li><a href="#adding_additional_backends">Adding additional backends</a><ul>
<li><a href="#create_a_storageclass_with_the_custom_secret">Create a StorageClass with the custom Secret</a></li>
</ul>
</li>
<li><a href="#advanced_install">Advanced install</a><ul>
<li><a href="#manual_csi_driver_install">Manual CSI driver install</a></li>
<li><a href="#common">Common</a></li>
<li><a href="#kubernetes_118">Kubernetes 1.18</a></li>
<li><a href="#kubernetes_117">Kubernetes 1.17</a></li>
<li><a href="#kubernetes_116">Kubernetes 1.16</a></li>
<li><a href="#kubernetes_115">Kubernetes 1.15</a></li>
</ul>
</li>
<li><a href="#legacy_versions">Legacy versions</a><ul>
<li><a href="#kubernetes_114">Kubernetes 1.14</a></li>
<li><a href="#kubernetes_113">Kubernetes 1.13</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="delivery_vehicles">Delivery vehicles<a class="headerlink" href="#delivery_vehicles" title="Permanent link">&para;</a></h2>
<p>As different methods of installation are provided, it might not be too obvious which delivery vehicle is the right one.</p>
<p><img alt="" src="img/helm.png" /></p>
<h3 id="need_help_deciding">Need help deciding?<a class="headerlink" href="#need_help_deciding" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>I have a...</th>
<th>Then you need...</th>
</tr>
</thead>
<tbody>
<tr>
<td>Vanilla upstream Kubernetes cluster on a supported host OS.</td>
<td>The <a href="#helm">Helm chart</a></td>
</tr>
<tr>
<td>Red Hat OpenShift 4.x cluster.</td>
<td>The <a href="../partners/redhat_openshift/index.html">certified CSI operator for OpenShift</a></td>
</tr>
<tr>
<td>Supported environment with multiple backends.</td>
<td><a href="#helm">Helm chart</a> with additional <a href="#create_a_secret_with_backend_details">Secrets</a> and <a href="using.html#base_storageclass_parameters">StorageClasses</a></td>
</tr>
<tr>
<td>HPE Ezmeral Container Platform environment.</td>
<td>The <a href="#helm">Helm chart</a></td>
</tr>
<tr>
<td>Operator Life-cycle Manager (OLM) environment.</td>
<td>The <a href="#operator">CSI operator</a></td>
</tr>
<tr>
<td>Unsupported host OS/Kubernetes cluster and like to tinker.</td>
<td>The <a href="#advanced_install">advanced install</a></td>
</tr>
</tbody>
</table>
<div class="admonition error">
<p class="admonition-title">Undecided?</p>
<p>If it's not clear what you should use for your environment, the Helm chart is most likely the correct answer.</p>
</div>
<h2 id="helm">Helm<a class="headerlink" href="#helm" title="Permanent link">&para;</a></h2>
<p><a href="https://helm.sh">Helm</a> is the package manager for Kubernetes. Software is being delivered in a format designated as a "chart". Helm is a <a href="https://helm.sh/docs/intro/install/">standalone CLI</a> that interacts with the Kubernetes API server using your <code>KUBECONFIG</code> file.</p>
<p>The official Helm chart for the HPE CSI Driver for Kubernetes is hosted on <a href="https://artifacthub.io/packages/helm/hpe-storage/hpe-csi-driver">Artifact Hub</a>. The chart only supports Helm 3 from version 1.3.0 of the HPE CSI Driver. In an effort to avoid duplicate documentation, please see the chart for instructions on how to deploy the CSI driver using Helm.</p>
<ul>
<li>Go to the chart on <a href="https://artifacthub.io/packages/helm/hpe-storage/hpe-csi-driver">Artifact Hub</a>.</li>
</ul>
<h2 id="operator">Operator<a class="headerlink" href="#operator" title="Permanent link">&para;</a></h2>
<p>The <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/">Operator pattern</a> is based on the idea that software should be instantiated and run with a set of custom controllers in Kubernetes. It creates a native experience for any software running in Kubernetes.</p>
<p>The official HPE CSI Operator for Kubernetes is hosted on <a href="https://operatorhub.io/operator/hpe-csi-operator">OperatorHub.io</a>. The CSI Operator images are hosted both on docker.io and officially certified containers on Red Hat Ecosystem Catalog.</p>
<h3 id="red_hat_openshift_container_platform">Red Hat OpenShift Container Platform<a class="headerlink" href="#red_hat_openshift_container_platform" title="Permanent link">&para;</a></h3>
<p>The HPE CSI Operator for Kubernetes is a fully certified Operator for OpenShift. There are a few tweaks needed and there's a separate section for OpenShift.</p>
<ul>
<li>See <a href="../partners/redhat_openshift/index.html">Red Hat OpenShift</a> in the partner ecosystem section</li>
</ul>
<h3 id="upstream_kubernetes_and_others">Upstream Kubernetes and others<a class="headerlink" href="#upstream_kubernetes_and_others" title="Permanent link">&para;</a></h3>
<p>Follow the documentation from the respective upstream distributions on how to deploy an Operator. In most cases, the Operator Lifecyle Manager (OLM) needs to be installed separately.</p>
<p>As an example, we'll deploy version <code>0.14.1</code> of the OLM to be able to manage the HPE CSI Operator. Familiarize yourself while is the latest stable release on the <a href="https://github.com/operator-framework/operator-lifecycle-manager/releases">OLM GitHub project's release page</a>.</p>
<p> <pre><code class=markdown>curl -sL https://github.com/operator-framework/operator-lifecycle-manager/releases/download/0.14.1/install.sh | bash -s 0.14.1
</code></pre></p>
<p>Install the HPE CSI Operator.</p>
<p> <pre><code class=markdown>kubectl create -f https://operatorhub.io/install/hpe-csi-operator.yaml
</code></pre></p>
<p>The Operator will be installed in <code>my-hpe-csi-operator</code> namespace. Watch it come up by inspecting the <code>ClusterServiceVersion</code> (CSV).</p>
<p> <pre><code class=markdown>kubectl get csv -n my-hpe-csi-operator
</code></pre></p>
<p>Next, a <code>HPECSIDriver</code> object needs to be instantiated. Create a file named <code>hpe-csi-operator.yaml</code> and populate it according to which CSP is being deployed.</p>
<div class=md-fenced-code-tabs id=tab-tab-group-3><input name=tab-group-3 type=radio id=tab-group-3-0_markdown checked=checked class=code-tab data-lang=markdown aria-controls=tab-group-3-0_markdown-panel role=tab><label for=tab-group-3-0_markdown class=code-tab-label data-lang=markdown id=tab-group-3-0_markdown-label>HPE Nimble Storage</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-3-0_markdown-panel aria-labelledby=tab-group-3-0_markdown-label><pre><code class=markdown>apiVersion: storage.hpe.com/v1
kind: HPECSIDriver
metadata:
  name: csi-driver
spec:
  backendType: nimble
  imagePullPolicy: IfNotPresent
  logLevel: info
  disableNodeConformance: false
  secret:
    backend: 192.168.1.1
    create: true
    password: admin
    servicePort: '8080'
    username: admin
  storageClass:
    allowVolumeExpansion: true
    create: true
    defaultClass: false
    name: hpe-standard
    parameters:
      accessProtocol: iscsi
      fsType: xfs
      volumeDescription: Volume created by the HPE CSI Driver for Kubernetes
</code></pre></div><input name=tab-group-3 type=radio id=tab-group-3-1_markdown class=code-tab data-lang=markdown aria-controls=tab-group-3-1_markdown-panel role=tab><label for=tab-group-3-1_markdown class=code-tab-label data-lang=markdown id=tab-group-3-1_markdown-label>HPE Primera and 3PAR</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-3-1_markdown-panel aria-labelledby=tab-group-3-1_markdown-label><pre><code class=markdown>apiVersion: storage.hpe.com/v1
kind: HPECSIDriver
metadata:
  name: csi-driver
spec:
  backendType: primera3par
  imagePullPolicy: IfNotPresent
  logLevel: info
  disableNodeConformance: false
  secret:
    backend: 10.10.0.1
    create: true
    password: 3pardata
    servicePort: '8080'
    username: 3paradm
  storageClass:
    allowVolumeExpansion: true
    create: true
    defaultClass: false
    name: hpe-standard
    parameters:
      accessProtocol: iscsi
      fsType: xfs
      volumeDescription: Volume created by the HPE CSI Driver for Kubernetes
</code></pre></div></div>
<p>Create a <code>HPECSIDriver</code> with the manifest.</p>
<p> <pre><code class=markdown>kubectl create -f hpe-csi-operator.yaml
</code></pre></p>
<p>The CSI driver is now ready for use. Proceed to the <a href="using.html">next section to learn about using</a> the driver.</p>
<h2 id="add_a_hpe_storage_backend">Add a HPE storage backend<a class="headerlink" href="#add_a_hpe_storage_backend" title="Permanent link">&para;</a></h2>
<p>Once the CSI driver is deployed, two additional objects needs to be created to get started with dynamic provisioning of persistent storage, a <code>Secret</code> and a <code>StorageClass</code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Naming the <code>Secret</code> and <code>StorageClass</code> is entirely up to the user, however, to keep up with the examples on SCOD, it's highly recommended to use the names illustrated here.</p>
</div>
<h3 id="secret_parameters">Secret parameters<a class="headerlink" href="#secret_parameters" title="Permanent link">&para;</a></h3>
<p>All parameters are mandatory and described below.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>serviceName</td>
<td>This hostname or IP address where the Container Storage Provider (CSP) is running, usually a Kubernetes <code>Service</code>, such as "nimble-csp-svc" or "primera3par-csp-svc"</td>
</tr>
<tr>
<td>servicePort</td>
<td>This is port the <code>serviceName</code> is listening to.</td>
</tr>
<tr>
<td>backend</td>
<td>This is the management hostname or IP address of the actual backend storage system, such as a Nimble or 3PAR array.</td>
</tr>
<tr>
<td>username</td>
<td>Backend storage system username with the correct privileges to perform storage management.</td>
</tr>
<tr>
<td>password</td>
<td>Backend storage system password.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class=md-fenced-code-tabs id=tab-tab-group-5><input name=tab-group-5 type=radio id=tab-group-5-0_markdown checked=checked class=code-tab data-lang=markdown aria-controls=tab-group-5-0_markdown-panel role=tab><label for=tab-group-5-0_markdown class=code-tab-label data-lang=markdown id=tab-group-5-0_markdown-label>HPE Nimble Storage</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-5-0_markdown-panel aria-labelledby=tab-group-5-0_markdown-label><pre><code class=markdown>apiVersion: v1
kind: Secret
metadata:
  name: hpe-backend
  namespace: kube-system
stringData:
  serviceName: nimble-csp-svc
  servicePort: &quot;8080&quot;
  backend: 192.168.1.2
  username: admin
  password: admin
</code></pre></div><input name=tab-group-5 type=radio id=tab-group-5-1_markdown class=code-tab data-lang=markdown aria-controls=tab-group-5-1_markdown-panel role=tab><label for=tab-group-5-1_markdown class=code-tab-label data-lang=markdown id=tab-group-5-1_markdown-label>HPE Primera</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-5-1_markdown-panel aria-labelledby=tab-group-5-1_markdown-label><pre><code class=markdown>apiVersion: v1
kind: Secret
metadata:
  name: hpe-backend
  namespace: kube-system
stringData:
  serviceName: primera3par-csp-svc
  servicePort: &quot;8080&quot;
  backend: 10.10.0.2
  username: 3paradm
  password: 3pardata
</code></pre></div></div>
<p>Create the <code>Secret</code> using <code>kubectl</code>:</p>
<p> <pre><code class=markdown>kubectl create -f secret.yaml
</code></pre></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In a real world scenario it's more practical to name the <code>Secret</code> something that makes sense for the organization. It could be the hostname of the backend or the role it carries, i.e "hpe-nimble-sanjose-prod".</p>
</div>
<p>Next step involves <a href="using.html#base_storageclass_parameters">creating a default StorageClass</a>.</p>
<h2 id="adding_additional_backends">Adding additional backends<a class="headerlink" href="#adding_additional_backends" title="Permanent link">&para;</a></h2>
<p>It's not uncommon to have multiple HPE primary storage systems within the same environment, either the same family or different ones. This section walks through the scenario of managing multiple <code>StorageClass</code> and <code>Secret</code> API objects to represent an environment with multiple systems.</p>
<p>There's a <a href="../learn/video_gallery/index.html#managing_multiple_hpe_primary_storage_backends_using_the_hpe_csi_driver">brief tutorial available</a> in the Video Gallery that walks through these steps.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make note of the Kubernetes <code>Namespace</code> or OpenShift project name used during the deployment. In the following examples, we will be using the "kube-system" <code>Namespace</code>.</p>
</div>
<p>To view the current <code>Secrets</code> in the "kube-system" <code>Namespace</code> (assuming default names):</p>
<p> <pre><code class=markdown>kubectl -n kube-system get secret/hpe-backend
NAME                     TYPE          DATA      AGE
hpe-backend              Opaque        5         2m
</code></pre></p>
<p>This <code>Secret</code> is used by the CSI sidecars in the <code>StorageClass</code> to authenticate to a specific backend for CSI operations. In order to add a new <code>Secret</code> or manage access to multiple backends, additional <code>Secrets</code> will need to be created per backend.</p>
<div class="admonition note">
<p class="admonition-title">Secret Requirements</p>
<ul>
<li>Each <code>Secret</code> name must be unique.</li>
<li><strong>servicePort</strong> should be set to <strong>8080</strong>.</li>
</ul>
</div>
<p>To create a new <code>Secret</code>, specify the name, <code>Namespace</code>, backend username, backend password and the backend IP address to be used by the CSP and save it as <code>custom-secret.yaml</code> (a detailed description of the parameters are <a href="#secret_parameters">available above</a>).</p>
<div class=md-fenced-code-tabs id=tab-tab-group-8><input name=tab-group-8 type=radio id=tab-group-8-0_markdown checked=checked class=code-tab data-lang=markdown aria-controls=tab-group-8-0_markdown-panel role=tab><label for=tab-group-8-0_markdown class=code-tab-label data-lang=markdown id=tab-group-8-0_markdown-label>HPE Nimble Storage</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-8-0_markdown-panel aria-labelledby=tab-group-8-0_markdown-label><pre><code class=markdown>apiVersion: v1
kind: Secret
metadata:
  name: custom-secret
  namespace: kube-system
stringData:
  serviceName: nimble-csp-svc
  servicePort: &quot;8080&quot;
  backend: 192.168.1.2
  username: admin
  password: admin
</code></pre></div><input name=tab-group-8 type=radio id=tab-group-8-1_markdown class=code-tab data-lang=markdown aria-controls=tab-group-8-1_markdown-panel role=tab><label for=tab-group-8-1_markdown class=code-tab-label data-lang=markdown id=tab-group-8-1_markdown-label>HPE Primera</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-8-1_markdown-panel aria-labelledby=tab-group-8-1_markdown-label><pre><code class=markdown>apiVersion: v1
kind: Secret
metadata:
  name: custom-secret
  namespace: kube-system
stringData:
  serviceName: primera3par-csp-svc
  servicePort: &quot;8080&quot;
  backend: 10.10.0.2
  username: 3paradm
  password: 3pardata
</code></pre></div></div>
<p>Create the <code>Secret</code> using <code>kubectl</code>:</p>
<p> <pre><code class=markdown>kubectl create -f custom-secret.yaml
</code></pre></p>
<p>You should now see the <code>Secret</code> in the "kube-system" <code>Namespace</code>:</p>
<p> <pre><code class=markdown>kubectl -n kube-system get secret/custom-secret
NAME                     TYPE          DATA      AGE
custom-secret            Opaque        5         1m
</code></pre></p>
<h3 id="create_a_storageclass_with_the_custom_secret">Create a StorageClass with the custom Secret<a class="headerlink" href="#create_a_storageclass_with_the_custom_secret" title="Permanent link">&para;</a></h3>
<p>To use the new <code>Secret</code> "custom-secret", create a new <code>StorageClass</code> using the <code>Secret</code> and the necessary <code>StorageClass</code> parameters. Please see the requirements section of the respective <a href="../container_storage_provider/index.html">CSP</a>.</p>
<div class=md-fenced-code-tabs id=tab-tab-group-11><input name=tab-group-11 type=radio id=tab-group-11-0_markdown checked=checked class=code-tab data-lang=markdown aria-controls=tab-group-11-0_markdown-panel role=tab><label for=tab-group-11-0_markdown class=code-tab-label data-lang=markdown id=tab-group-11-0_markdown-label>K8s 1.15+</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-11-0_markdown-panel aria-labelledby=tab-group-11-0_markdown-label><pre><code class=markdown>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: hpe-custom
provisioner: csi.hpe.com
parameters:
  csi.storage.k8s.io/fstype: xfs
  csi.storage.k8s.io/controller-expand-secret-name: custom-secret
  csi.storage.k8s.io/controller-expand-secret-namespace: kube-system
  csi.storage.k8s.io/controller-publish-secret-name: custom-secret
  csi.storage.k8s.io/controller-publish-secret-namespace: kube-system
  csi.storage.k8s.io/node-publish-secret-name: custom-secret
  csi.storage.k8s.io/node-publish-secret-namespace: kube-system
  csi.storage.k8s.io/node-stage-secret-name: custom-secret
  csi.storage.k8s.io/node-stage-secret-namespace: kube-system
  csi.storage.k8s.io/provisioner-secret-name: custom-secret
  csi.storage.k8s.io/provisioner-secret-namespace: kube-system
  description: &quot;Volume created by using a custom Secret with the HPE CSI Driver for Kubernetes&quot;
reclaimPolicy: Delete
allowVolumeExpansion: true
</code></pre></div><input name=tab-group-11 type=radio id=tab-group-11-1_markdown class=code-tab data-lang=markdown aria-controls=tab-group-11-1_markdown-panel role=tab><label for=tab-group-11-1_markdown class=code-tab-label data-lang=markdown id=tab-group-11-1_markdown-label>K8s 1.14</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-11-1_markdown-panel aria-labelledby=tab-group-11-1_markdown-label><pre><code class=markdown>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: hpe-custom
provisioner: csi.hpe.com
parameters:
  csi.storage.k8s.io/fstype: xfs
  csi.storage.k8s.io/resizer-secret-name: custom-secret
  csi.storage.k8s.io/resizer-secret-namespace: kube-system
  csi.storage.k8s.io/controller-publish-secret-name: custom-secret
  csi.storage.k8s.io/controller-publish-secret-namespace: kube-system
  csi.storage.k8s.io/node-publish-secret-name: custom-secret
  csi.storage.k8s.io/node-publish-secret-namespace: kube-system
  csi.storage.k8s.io/node-stage-secret-name: custom-secret
  csi.storage.k8s.io/node-stage-secret-namespace: kube-system
  csi.storage.k8s.io/provisioner-secret-name: custom-secret
  csi.storage.k8s.io/provisioner-secret-namespace: kube-system
  description: &quot;Volume created by using a custom Secret with the HPE CSI Driver for Kubernetes&quot;
reclaimPolicy: Delete
allowVolumeExpansion: true
</code></pre></div><input name=tab-group-11 type=radio id=tab-group-11-2_markdown class=code-tab data-lang=markdown aria-controls=tab-group-11-2_markdown-panel role=tab><label for=tab-group-11-2_markdown class=code-tab-label data-lang=markdown id=tab-group-11-2_markdown-label>K8s 1.13</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-11-2_markdown-panel aria-labelledby=tab-group-11-2_markdown-label><pre><code class=markdown>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: hpe-custom
provisioner: csi.hpe.com
parameters:
  csi.storage.k8s.io/fstype: xfs
  csi.storage.k8s.io/controller-publish-secret-name: custom-secret
  csi.storage.k8s.io/controller-publish-secret-namespace: kube-system
  csi.storage.k8s.io/node-publish-secret-name: custom-secret
  csi.storage.k8s.io/node-publish-secret-namespace: kube-system
  csi.storage.k8s.io/node-stage-secret-name: custom-secret
  csi.storage.k8s.io/node-stage-secret-namespace: kube-system
  csi.storage.k8s.io/provisioner-secret-name: custom-secret
  csi.storage.k8s.io/provisioner-secret-namespace: kube-system
  description: &quot;Volume created by using a custom Secret with the HPE CSI Driver for Kubernetes&quot;
reclaimPolicy: Delete
</code></pre></div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don't forget to call out the <code>StorageClass</code> explictly when creating <code>PVCs</code> from non-default <code>StorageClasses</code>.</p>
</div>
<p>Next, <a href="using.html#create_a_persistentvolumeclaim_from_a_storageclass">Create a PersistentVolumeClaim from a StorageClass</a>.</p>
<h2 id="advanced_install">Advanced install<a class="headerlink" href="#advanced_install" title="Permanent link">&para;</a></h2>
<p>This guide is primarily written to accommodate a highly manual installation on upstream Kubernetes or partner OEMs engaged with HPE to bundle the HPE CSI Driver in a custom distribution. Installation steps may vary for different vendors and flavors of Kubernetes.</p>
<p>The following example walks through deployment of the <strong>latest</strong> CSI driver.</p>
<div class="admonition caution">
<p class="admonition-title">Critical</p>
<p>It's highly recommended to use either the Helm chart or Operator to install the HPE CSI Driver for Kubernetes and the associated Container Storage Providers. Only venture down manual installation if your requirements can't be met by the <a href="deployment.html#helm">Helm chart</a> or <a href="deployment.html#operator">Operator</a>.</p>
</div>
<h3 id="manual_csi_driver_install">Manual CSI driver install<a class="headerlink" href="#manual_csi_driver_install" title="Permanent link">&para;</a></h3>
<p>Deploy the CSI driver and sidecars for the relevant Kubernetes version.</p>
<h3 id="common">Common<a class="headerlink" href="#common" title="Permanent link">&para;</a></h3>
<p>These object configuration files are common for all versions of Kubernetes.</p>
<p>Worker node IO settings:</p>
<p> <pre><code class=markdown>kubectl create -f https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/hpe-linux-config.yaml
</code></pre></p>
<p>Container Storage Provider:</p>
<div class=md-fenced-code-tabs id=tab-tab-group-13><input name=tab-group-13 type=radio id=tab-group-13-0_markdown checked=checked class=code-tab data-lang=markdown aria-controls=tab-group-13-0_markdown-panel role=tab><label for=tab-group-13-0_markdown class=code-tab-label data-lang=markdown id=tab-group-13-0_markdown-label>HPE Nimble Storage</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-13-0_markdown-panel aria-labelledby=tab-group-13-0_markdown-label><pre><code class=markdown>kubectl create -f https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/nimble-csp.yaml
</code></pre></div><input name=tab-group-13 type=radio id=tab-group-13-1_markdown class=code-tab data-lang=markdown aria-controls=tab-group-13-1_markdown-panel role=tab><label for=tab-group-13-1_markdown class=code-tab-label data-lang=markdown id=tab-group-13-1_markdown-label>HPE 3PAR and Primera</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-13-1_markdown-panel aria-labelledby=tab-group-13-1_markdown-label><pre><code class=markdown>kubectl create -f https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/3par-primera-csp.yaml
</code></pre></div></div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The above instructions assumes you have an array with a supported platform OS installed. Please see the requirements section of the respective <a href="../container_storage_provider/index.html">CSP</a>.</p>
</div>
<p>After deploying the CSI driver for the particular version of Kubernetes being used below, <a href="#add_a_hpe_storage_backend">add a HPE storage backend</a>.</p>
<h3 id="kubernetes_118">Kubernetes 1.18<a class="headerlink" href="#kubernetes_118" title="Permanent link">&para;</a></h3>
<p> <pre><code class=markdown>kubectl create -f https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/hpe-csi-k8s-1.18.yaml
</code></pre></p>
<h3 id="kubernetes_117">Kubernetes 1.17<a class="headerlink" href="#kubernetes_117" title="Permanent link">&para;</a></h3>
<p> <pre><code class=markdown>kubectl create -f https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/hpe-csi-k8s-1.17.yaml
</code></pre></p>
<h3 id="kubernetes_116">Kubernetes 1.16<a class="headerlink" href="#kubernetes_116" title="Permanent link">&para;</a></h3>
<p> <pre><code class=markdown>kubectl create -f https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/hpe-csi-k8s-1.16.yaml
</code></pre></p>
<h3 id="kubernetes_115">Kubernetes 1.15<a class="headerlink" href="#kubernetes_115" title="Permanent link">&para;</a></h3>
<p> <pre><code class=markdown>kubectl create -f https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/hpe-csi-k8s-1.15.yaml
</code></pre></p>
<h2 id="legacy_versions">Legacy versions<a class="headerlink" href="#legacy_versions" title="Permanent link">&para;</a></h2>
<p>Older versions of the HPE CSI Driver for Kubernetes are kept here for reference. Check the CSI driver GitHub repo for the appropriate YAML files to declare on the cluster for the respective version of Kubernetes.</p>
<h3 id="kubernetes_114">Kubernetes 1.14<a class="headerlink" href="#kubernetes_114" title="Permanent link">&para;</a></h3>
<ul>
<li>Object definitons for <a href="https://github.com/hpe-storage/co-deployments/tree/master/yaml/csi-driver/v1.2.0">HPE CSI Driver for Kubernetes v1.2.0</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Latest supported CSI driver version is 1.2.0 for Kubernetes 1.14.</p>
</div>
<h3 id="kubernetes_113">Kubernetes 1.13<a class="headerlink" href="#kubernetes_113" title="Permanent link">&para;</a></h3>
<ul>
<li>Object definitons for <a href="https://github.com/hpe-storage/co-deployments/tree/master/yaml/csi-driver/v1.1.0">HPE CSI Driver for Kubernetes v1.1.0</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Latest supported CSI driver version is 1.1.0 for Kubernetes 1.13.</p>
</div>
<p>Depending on which version being deployed, different API objects gets created.</p>
              
            </div>
          </div>

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="using.html" class="btn btn-neutral float-right" title="Using">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2020 Hewlett Packard Enterprise Development LP<br />Give <a href="https://github.com/hpe-storage/scod/issues/new?title=csi_driver/deployment.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="index.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="using.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
