<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
    
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Hewlett Packard Enterprise">
  <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta property="og:title" content="HPE Storage Container Orchestrator Documentation"/>
    <meta property="og:description" content="This is an umbrella documentation project for all Kubernetes and Docker integrations for HPE primary storage tailored for IT Ops, developers and partners. Including HPE 3PAR and Primera, HPE Cloud Volumes and HPE Nimble Storage."/>
    <meta property="og:locale" content="en_US"/>
    <meta property="og:url" content="https://scod.hpedev.io"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://scod.hpedev.io/img/hpe-social-og-image01.jpg"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    
  <title>Persistent Storage for Kubernetes - HPE Storage Container Orchestrator Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/hpedev.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Persistent Storage for Kubernetes";
    var mkdocs_page_input_path = "learn/persistent_storage/index.md";
    var mkdocs_page_url = "/learn/persistent_storage/index.html";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-79554149-3', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> HPE Storage Container Orchestrator Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">WELCOME</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../welcome/index.html">Get started!</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">HPE CSI DRIVER FOR KUBERNETES</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../csi_driver/index.html">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../csi_driver/deployment.html">Deployment</a>
                </li>
                <li class="">
                    
    <a class="" href="../../csi_driver/using.html">Using</a>
                </li>
                <li class="">
                    
    <a class="" href="../../csi_driver/monitor.html">Pod Monitor</a>
                </li>
                <li class="">
                    
    <a class="" href="../../csi_driver/diagnostics.html">Diagnostics</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">CONTAINER STORAGE PROVIDERS</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../container_storage_provider/hpe_3par_primera/index.html">HPE 3PAR and Primera</a>
                </li>
                <li class="">
                    
    <a class="" href="../../container_storage_provider/hpe_nimble_storage/index.html">HPE Nimble Storage</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">LEGACY FLEXVOLUME DRIVER</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../flexvolume_driver/container_provider/index.html">Container Provider: Nimble and CV</a>
                </li>
                <li class="">
                    
    <a class="" href="../../flexvolume_driver/hpe_3par_primera_installer/index.html">Ansible installer for 3PAR/Primera</a>
                </li>
                <li class="">
                    
    <a class="" href="../../flexvolume_driver/dory/index.html">History: Dory and Doryd </a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">DOCKER VOLUME PLUGINS</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../docker_volume_plugins/hpe_cloud_volumes/index.html">HPE Cloud Volumes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../docker_volume_plugins/hpe_nimble_storage/index.html">HPE Nimble Storage</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">PARTNER ECOSYSTEMS</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../partners/rancher_labs/index.html">Rancher Labs</a>
                </li>
                <li class="">
                    
    <a class="" href="../../partners/redhat_openshift/index.html">Red Hat OpenShift</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">LEARN</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../containers101/index.html">Cloud-Native, Containers & DevOps</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="index.html">Persistent Storage for Kubernetes</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#overview">Overview</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#kubernetes_101">Kubernetes 101</a></li>
        
            <li><a class="toctree-l4" href="#lab_1_tour_your_cluster">Lab 1: Tour your cluster</a></li>
        
            <li><a class="toctree-l4" href="#lab_2_install_k8s_dashboard">Lab 2: Install K8s dashboard</a></li>
        
            <li><a class="toctree-l4" href="#lab_3_deploy_your_first_pod">Lab 3: Deploy your first pod</a></li>
        
            <li><a class="toctree-l4" href="#lab_4_install_the_csi_driver">Lab 4: Install the CSI driver</a></li>
        
            <li><a class="toctree-l4" href="#lab_5_deploying_wordpress">Lab 5: Deploying Wordpress</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../introduction_to_containers/index.html">For HPE partners:<br />&nbsp;&nbsp; Introduction to Containers</a>
                </li>
                <li class="">
                    
    <a class="" href="../video_gallery/index.html">Video Gallery</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">COMMUNITY</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="https://developer.hpe.com">HPE Developer Community</a>
                </li>
                <li class="">
                    
    <a class="" href="https://slack.hpedev.io">Sign up to HPE DEV on Slack</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/hpe-storage/scod/issues/new?title=I have some feedback on SCOD">Got feedback?</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">EXTERNAL LINKS</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="https://github.com/hpe-storage/scod">SCOD on GitHub</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/hpe-storage">HPE Storage on GitHub</a>
                </li>
                <li class="">
                    
    <a class="" href="https://hpe.com/storage/containers">Storage for Containers on hpe.com</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">LEGAL</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../legal/contributing/index.html">Contributing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../legal/support/index.html">Support</a>
                </li>
                <li class="">
                    
    <a class="" href="../../legal/license/index.html">License</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">HPE Storage Container Orchestrator Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>LEARN &raquo;</li>
        
      
    
    <li>Persistent Storage for Kubernetes</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h1>
<p>This is a free learning resource from HPE which walks you through various exercises to get you familiar with Kubernetes and provisioning Persistent storage using HPE Nimble Storage, HPE Primera or HPE 3PAR storage systems. This guide is by no means a comprehensive overview of the capabilities of Kubernetes but rather a getting started guide for individuals who wants to learn how to use Kubernetes with persistent storage.</p>
<div class="toc">
<ul>
<li><a href="#overview">Overview</a><ul>
<li><a href="#kubernetes_101">Kubernetes 101</a><ul>
<li><a href="#the_basics">The basics</a><ul>
<li><a href="#nodes">Nodes</a></li>
<li><a href="#master">Master</a></li>
<li><a href="#kubernetes_cluster">Kubernetes Cluster</a></li>
<li><a href="#persistent_volumes">Persistent Volumes</a></li>
<li><a href="#containers">Containers</a></li>
<li><a href="#pods">Pods</a></li>
<li><a href="#namespaces">Namespaces</a></li>
<li><a href="#deployments">Deployments</a></li>
<li><a href="#services">Services</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#lab_1_tour_your_cluster">Lab 1: Tour your cluster</a><ul>
<li><a href="#overview_of_kubectl">Overview of kubectl</a></li>
<li><a href="#syntax">Syntax</a></li>
<li><a href="#getting_to_know_your_cluster">Getting to know your cluster:</a></li>
</ul>
</li>
<li><a href="#lab_2_install_k8s_dashboard">Lab 2: Install K8s dashboard</a><ul>
<li><a href="#deploying_the_dashboard_ui">Deploying the Dashboard UI</a></li>
<li><a href="#accessing_the_dashboard_ui">Accessing the Dashboard UI</a></li>
<li><a href="#create_the_admin_service_account">Create the Admin Service Account</a></li>
<li><a href="#create_clusterrolebinding">Create ClusterRoleBinding</a></li>
<li><a href="#get_token">Get Token</a></li>
</ul>
</li>
<li><a href="#lab_3_deploy_your_first_pod">Lab 3: Deploy your first pod</a></li>
<li><a href="#lab_4_install_the_csi_driver">Lab 4: Install the CSI driver</a><ul>
<li><a href="#installing_the_chart">Installing the chart</a></li>
<li><a href="#creating_a_secret">Creating a Secret</a></li>
<li><a href="#creating_a_storageclass">Creating a StorageClass</a></li>
<li><a href="#creating_a_persistentvolumeclaim">Creating a PersistentVolumeClaim</a></li>
</ul>
</li>
<li><a href="#lab_5_deploying_wordpress">Lab 5: Deploying Wordpress</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="kubernetes_101">Kubernetes 101<a class="headerlink" href="#kubernetes_101" title="Permanent link">&para;</a></h2>
<h3 id="the_basics">The basics<a class="headerlink" href="#the_basics" title="Permanent link">&para;</a></h3>
<p>The first thing we need to do is to understand the various components of Kubernetes.</p>
<h5 id="nodes"><u>Nodes</u><a class="headerlink" href="#nodes" title="Permanent link">&para;</a></h5>
<p><img alt="" src="img/node.png" /> <br /> <br />
The nodes in a Kubernetes cluster are the machines (VMs, physical servers, etc) that run your applications and cloud workflows. The Kubernetes master controls each node; you’ll rarely interact with nodes directly.</p>
<h5 id="master"><u>Master</u><a class="headerlink" href="#master" title="Permanent link">&para;</a></h5>
<p><img alt="" src="img/master.png" /> <br /> <br />
The Kubernetes master is responsible for maintaining the desired state of your cluster. When you interact with Kubernetes, such as by using the <code>kubectl</code> command-line interface, you’re communicating with your cluster’s Kubernetes master nodes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>"Master” refers to a collection of processes managing the cluster state. Typically all these processes run on a single node within the cluster, and this node is also referred to as the master. The master can be replicated for availability and redundancy.</p>
</div>
<h5 id="kubernetes_cluster"><u>Kubernetes Cluster</u><a class="headerlink" href="#kubernetes_cluster" title="Permanent link">&para;</a></h5>
<p><img alt="" src="img/cluster.png" /> <br /> <br />
In Kubernetes, nodes pool together their resources (memory and CPU) to distribute workloads. A cluster is comprised of a control plane, master and worker nodes, and physical machines that allow you to run your container workloads on.</p>
<h5 id="persistent_volumes"><u>Persistent Volumes</u><a class="headerlink" href="#persistent_volumes" title="Permanent link">&para;</a></h5>
<p><img alt="" src="img/persistent_volumes.png" /> <br /> <br /></p>
<p>Because programs running on your cluster aren’t guaranteed to run on a specific node, data can’t be saved to any arbitrary place in the file system. If a program tries to save data to a file for later, but is then relocated onto a new node, the file will no longer be where the program expects it to be. </p>
<p>To store data permanently, Kubernetes uses Persistent Volumes. Local, external storage via SAN arrays, or cloud drives can be attached to the cluster as a Persistent Volume.</p>
<h3> Kubernetes Objects </h3>

<h5 id="containers"><u>Containers</u><a class="headerlink" href="#containers" title="Permanent link">&para;</a></h5>
<p><img alt="" src="img/container.png" />  <br /> <br />
Programs running on Kubernetes are packaged as containers which can run on Linux or Windows. A container image is a lightweight, standalone, executable package of software that includes everything needed to run an application: code, runtime, system tools, system libraries and settings.</p>
<h5 id="pods"><u>Pods</u><a class="headerlink" href="#pods" title="Permanent link">&para;</a></h5>
<p><img alt="" src="img/pod.png" /> <br /> <br />
A Pod is the basic execution unit of a Kubernetes application–the smallest and simplest unit in the Kubernetes object model that you create or deploy. A Pod encapsulates an application’s container (or, in some cases, multiple containers), storage resources, a unique network IP, and options that govern how the container(s) should run.</p>
<h5 id="namespaces"><u>Namespaces</u><a class="headerlink" href="#namespaces" title="Permanent link">&para;</a></h5>
<p><img alt="" src="img/namespaces.png" /> <br /> <br />
Kubernetes supports multiple virtual clusters backed by the same physical cluster. These virtual clusters are called namespaces. Namespaces are intended for use in environments with many users spread across multiple teams, or projects. Namespaces are a way to divide cluster resources between multiple users.</p>
<h5 id="deployments"><u>Deployments</u><a class="headerlink" href="#deployments" title="Permanent link">&para;</a></h5>
<p>A Deployment provides declarative updates for Pods. You declare a desired state for your pods in your Deployment and Kubernetes will manage it for you automatically.</p>
<h5 id="services"><u>Services</u><a class="headerlink" href="#services" title="Permanent link">&para;</a></h5>
<p>A Kubernetes Service object defines a policy for external clients to access an application within a cluster. By default, Docker uses host-private networking, so containers can talk to other containers only if they are on the same machine. In order for Docker containers to communicate across nodes, there must be allocated ports on the machine’s own IP address, which are then forwarded or proxied to the containers. Coordinating port allocations is very difficult to do at scale, and exposes users to cluster-level issues outside of their control. Kubernetes assumes that pods can communicate with other pods, regardless of which host they land on. Kubernetes gives every pod its own cluster-private IP address, through a Kubernetes Service object, so you do not need to explicitly create links between pods or map container ports to host ports. This means that containers within a Pod can all reach each other’s ports on localhost, and all pods in a cluster can see each other without NAT.</p>
<hr />
<h2 id="lab_1_tour_your_cluster">Lab 1: Tour your cluster<a class="headerlink" href="#lab_1_tour_your_cluster" title="Permanent link">&para;</a></h2>
<p>All of this information presented here is taken from the official documentation found on <a href="https://kubernetes.io/docs/">kubernetes.io/docs</a>.</p>
<h3 id="overview_of_kubectl">Overview of kubectl<a class="headerlink" href="#overview_of_kubectl" title="Permanent link">&para;</a></h3>
<p>The Kubernetes command-line tool, <code>kubectl</code>, allows you to run commands against Kubernetes clusters. You can use <code>kubectl</code> to deploy applications, inspect and manage cluster resources, and view logs. For a complete list of <code>kubectl</code> operations, see <a href="https://kubernetes.io/docs/reference/kubectl/overview/">Overview of kubectl</a> on kubernetes.io.</p>
<p>For more information on how to install and setup <code>kubectl</code> on Linux, Windows or MacOS, see <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">Install and Set Up kubectl</a> on kubernetes.io.</p>
<h3 id="syntax">Syntax<a class="headerlink" href="#syntax" title="Permanent link">&para;</a></h3>
<p>Use the following syntax to run <code>kubectl</code> commands from your terminal window:</p>
<p><code>kubectl [command] [TYPE] [NAME] [flags]</code></p>
<p>where <code>command</code>, <code>TYPE</code>, <code>NAME</code>, and <code>flags</code> are:</p>
<ul>
<li>
<p><code>command</code>: Specifies the operation that you want to perform on one or more resources, for example create, get, describe, delete.</p>
</li>
<li>
<p><code>TYPE</code>: Specifies the resource type. Resource types are case-insensitive and you can specify the singular, plural, or abbreviated forms. For example, the following commands produce the same output:</p>
</li>
</ul>
<p> <pre><code class=markdown>kubectl get pod pod1
kubectl get pods pod1
kubectl get po pod1
</code></pre></p>
<ul>
<li><code>NAME</code>: Specifies the name of the resource. Names are case-sensitive. If the name is omitted, details for all resources are displayed, for example <code>kubectl get pods</code>.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Kubernetes Cheat Sheet</p>
<p>Find more available commands at <a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/">Kubernetes Cheat Sheet</a> on kubernetes.io.</p>
</div>
<h3 id="getting_to_know_your_cluster">Getting to know your cluster:<a class="headerlink" href="#getting_to_know_your_cluster" title="Permanent link">&para;</a></h3>
<p>Let's run through some simple <code>kubectl</code> commands to get familiar with your cluster.</p>
<p>In order to communicate with the Kubernetes cluster, <code>kubectl</code> looks for a file named config in the <code>$HOME/.kube</code> directory. You can specify other <code>kubeconfig</code> files by setting the <code>KUBECONFIG</code> environment variable or by setting the <code>--kubeconfig</code> flag.</p>
<p>To view your config file:</p>
<p> <pre><code class=markdown>kubectl config view
</code></pre></p>
<p>Check that <code>kubectl</code> and the config file are properly configured by getting the cluster state.</p>
<p> <pre><code class=markdown>kubectl cluster-info
</code></pre></p>
<p>If you see a URL response, <code>kubectl</code> is correctly configured to access your cluster.</p>
<p>The output is similar to this:</p>
<p> <pre><code class=markdown>$ kubectl cluster-info
Kubernetes master is running at https://10.90.200.11:6443
coredns is running at https://10.90.200.11:6443/api/v1/namespaces/kube-system/services/coredns:dns/proxy
kubernetes-dashboard is running at https://10.90.200.11:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
</code></pre></p>
<p>Now let's look at the nodes within our cluster.</p>
<p> <pre><code class=markdown>kubectl get nodes
</code></pre></p>
<p>You should see output similar to below. As you can see, each node has a role <strong>master</strong> or as <strong>worker</strong> nodes (&lt;none&gt;).</p>
<p> <pre><code class=markdown>$ kubectl get nodes
NAME              STATUS   ROLES    AGE   VERSION
kube-g1-master1   Ready    master   37d   v1.18.2
kube-g1-node1     Ready    &lt;none&gt;   37d   v1.18.2
kube-g1-node2     Ready    &lt;none&gt;   37d   v1.18.2
</code></pre></p>
<p>You can list pods.</p>
<p> <pre><code class=markdown>kubectl get pods
</code></pre></p>
<div class="admonition note">
<p class="admonition-title">Quiz</p>
<p>Did you see any pods listed when you ran <code>kubectl get pods</code>?  <strong>Why?</strong> <br /> <br /> If you don't see any pods listed, it is because there are no pods deployed within the <code>default</code> namespace. Now run, <code>kubectl get pods --all-namespaces</code>. <strong>Does it look any different?</strong> <br /> <br /> Pay attention to the first column, <strong>NAMESPACES</strong>. In our case, we are working in the <code>default</code> namespace. Depending on the type of application and your user access level, applications can be deployed within one or more namespaces. <br /> <br />If you don't see the object (deployment, pod, services, etc) you are looking for, double-check the namespace it was deployed under and use the <code>-n &lt;namespace&gt;</code> flag to view objects in other namespaces.</p>
</div>
<p>Now that you have familiarized yourself with your cluster, let's configure the Kubernetes dashboard.</p>
<hr />
<h2 id="lab_2_install_k8s_dashboard">Lab 2: Install K8s dashboard<a class="headerlink" href="#lab_2_install_k8s_dashboard" title="Permanent link">&para;</a></h2>
<p>Dashboard is a web-based Kubernetes user interface. You can use Dashboard to deploy containerized applications to a Kubernetes cluster, troubleshoot your containerized application, and manage the cluster resources. You can use Dashboard to get an overview of applications running on your cluster, as well as for creating or modifying individual Kubernetes resources (such as Deployments, Jobs, DaemonSets, etc). For example, you can scale a Deployment, initiate a rolling update, restart a pod or deploy new applications using a deploy wizard.</p>
<p>Dashboard also provides information on the state of Kubernetes resources in your cluster and on any errors that may have occurred.</p>
<p>Please refer to <a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Kubernetes Web UI (Dashboard)</a> on kubernetes.io.</p>
<h3 id="deploying_the_dashboard_ui">Deploying the Dashboard UI<a class="headerlink" href="#deploying_the_dashboard_ui" title="Permanent link">&para;</a></h3>
<p>The Dashboard UI is not deployed by default. To deploy it, run the following command.</p>
<p> <pre><code class=markdown>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml
</code></pre></p>
<h3 id="accessing_the_dashboard_ui">Accessing the Dashboard UI<a class="headerlink" href="#accessing_the_dashboard_ui" title="Permanent link">&para;</a></h3>
<p>You can access Dashboard using <code>kubectl</code> from your desktop.</p>
<p> <pre><code class=markdown>kubectl proxy
</code></pre></p>
<p>Open a web browser, copy the following URL to access the Dashboard.</p>
<p> <pre><code class=markdown>http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
</code></pre></p>
<p>You should see something similar to the following:</p>
<p><img alt="" src="img/dashboard.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Dashboard UI can only be accessed from the machine where the command is executed. See <code>kubectl proxy --help</code> for more options.</p>
</div>
<h3 id="create_the_admin_service_account">Create the Admin Service Account<a class="headerlink" href="#create_the_admin_service_account" title="Permanent link">&para;</a></h3>
<p>To protect your cluster data, Dashboard deploys with a minimal RBAC configuration by default. Currently, Dashboard only supports logging in with a Bearer Token. To create a token for this demo, we will create an admin user.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The admin user created in the tutorial will have administrative privileges and is for educational purposes only.</p>
</div>
<p>Open a second terminal, if you don't have one open already. </p>
<p>The below YAML declarations are meant to be created with <code>kubectl create</code>. Either copy the content to a file on the host where <code>kubectl</code> is being executed, or copy &amp; paste into the terminal, like this:</p>
<p> <pre><code class=markdown>kubectl create -f-
&lt; paste the YAML &gt;
^D (CTRL + D)
</code></pre></p>
<p>Step by step:</p>
<p> <pre><code class=markdown>kubectl create -f-
</code></pre></p>
<p>Press <strong>Enter</strong>.</p>
<p>Copy the code below into the terminal.</p>
<p> <pre><code class=markdown>apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kube-system
</code></pre></p>
<p>Press <strong>Enter</strong> and <strong>Ctrl-D</strong>.</p>
<h3 id="create_clusterrolebinding">Create ClusterRoleBinding<a class="headerlink" href="#create_clusterrolebinding" title="Permanent link">&para;</a></h3>
<p>Let's create the ClusterRoleBinding for the new admin-user. We will apply the <code>cluster-admin</code> role to the <code>admin-user</code>.</p>
<p> <pre><code class=markdown>kubectl create -f-
</code></pre></p>
<p>Press <strong>Enter</strong>.</p>
<p>Copy the code below into the terminal.</p>
<p> <pre><code class=markdown>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kube-system
</code></pre></p>
<p>Press <strong>Enter</strong> and <strong>Ctrl-D</strong>.</p>
<h3 id="get_token">Get Token<a class="headerlink" href="#get_token" title="Permanent link">&para;</a></h3>
<p>Now we are ready to get the token from the admin-user in order to log into the dashboard. Run the following command:</p>
<p> <pre><code class=markdown>kubectl -n kube-system get secret | grep admin-user
</code></pre></p>
<p>It will return something similar to: <code>admin-user-token-n7jx9</code>.</p>
<p>Now run.</p>
<p> <pre><code class=markdown>kubectl -n kube-system describe secret admin-user-token-n7jx9
</code></pre></p>
<p>Copy the token value.</p>
<p> <pre><code class=markdown>Name:         admin-user-token-n7jx9
Namespace:    kube-system
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name: admin-user
              kubernetes.io/service-account.uid: 7e9a4b56-e692-496a-8767-965076a282a4

Type:  kubernetes.io/service-account-token

Data
====
namespace:  11 bytes
token:      &lt;your token will be shown here&gt;
ca.crt:     1025 bytes
</code></pre></p>
<p>Switch back over to your browser and paste the <strong>token</strong> into the dashboard and <strong>Click - Sign In</strong>. From here, you can see the health of your cluster as well as inspect various objects (Pods, StorageClass, Persistent Volume Claims) and manage the cluster resources.</p>
<p>You should see something similar to the following: 
<br /></p>
<p><img alt="" src="img/dashboard_success.png" /></p>
<p><br /></p>
<hr />
<h2 id="lab_3_deploy_your_first_pod">Lab 3: Deploy your first pod<a class="headerlink" href="#lab_3_deploy_your_first_pod" title="Permanent link">&para;</a></h2>
<p>A pod is a collection of containers sharing a network and mount namespace and is the basic unit of deployment in Kubernetes. All containers in a pod are scheduled on the same node.</p>
<p>Let's create a simple <strong>nginx</strong> webserver.</p>
<p> <pre><code class>kubectl create -f-
</code></pre></p>
<p>Press <strong>Enter</strong>.</p>
<p>Copy and paste the following:</p>
<p> <pre><code class=markdown>apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    run: nginx
  name: first-nginx-pod
spec:
  replicas: 1
  selector:
    matchLabels:
      run: nginx-first-pod
  template:
    metadata:
      labels:
        run: nginx-first-pod
    spec:
      containers:
      - image: nginx
        name: nginx
</code></pre></p>
<p>Press <strong>Enter</strong> and <strong>Ctrl-D</strong>. </p>
<p>We can now see the pod running.</p>
<p> <pre><code class=markdown>kubectl get pods
NAME                               READY   STATUS    RESTARTS   AGE
first-nginx-pod-5bb4787f8d-7ndj6   1/1     Running   0          6m39s
</code></pre></p>
<p>We can inspect the pod further using the <strong>kubectl describe</strong> command:</p>
<p> <pre><code class=markdown>Name:         first-nginx-pod-5bb4787f8d-7ndj6
Namespace:    default
Priority:     0
Node:         kube-g1-node1/10.90.200.184
Start Time:   Mon, 02 Mar 2020 17:09:20 -0600
Labels:       pod-template-hash=5bb4787f8d
              run=nginx-first-pod
Annotations:  &lt;none&gt;
Status:       Running
IP:           10.233.82.7
IPs:
  IP:           10.233.82.7
Controlled By:  ReplicaSet/first-nginx-pod-5bb4787f8d
Containers:
  nginx:
    Container ID:   docker://a0938f10d28cb0395b0c2c324ef0c74ecdcdc63e556863c53ee7a88d56d
    Image:          nginx
    Image ID:       docker-pullable://nginx@sha256:380eb808e2a3b0a15037efefcabc5b4e03d666d03
    Port:           &lt;none&gt;
    Host Port:      &lt;none&gt;
    State:          Running
      Started:      Mon, 20 Aug 2020 17:09:32 -0600
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-m2vbl (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  default-token-m2vbl:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-m2vbl
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type    Reason     Age        From                    Message
  ----    ------     ----       ----                    -------
  Normal  Scheduled  &lt;unknown&gt;  default-scheduler       Successfully assigned default/first-nginx-pod
  Normal  Pulling    54s        kubelet, kube-g1-node1  Pulling image &quot;nginx&quot;
  Normal  Pulled     46s        kubelet, kube-g1-node1  Successfully pulled image &quot;nginx&quot;
  Normal  Created    44s        kubelet, kube-g1-node1  Created container nginx
  Normal  Started    43s        kubelet, kube-g1-node1  Started container nginx
</code></pre></p>
<p>Let's find the IP address of the pod.</p>
<p> <pre><code class=markdown>kubectl get pod first-nginx-pod-5bb4787f8d-7ndj6 -o=jsonpath='{.status.podIP}'
</code></pre></p>
<p>The output should be similar to the following.</p>
<p> <pre><code class=markdown>$ kubectl get pod first-nginx-pod-5bb4787f8d-7ndj6 -o=jsonpath='{.status.podIP}'
10.233.82.7

</code></pre></p>
<p>This IP address (10.233.82.7) is only accessible from within the cluster, so let's use <code>port-forward</code> to expose the <code>pod</code> port temporarily outside the cluster.</p>
<p> <pre><code class=markdown>kubectl port-forward first-nginx-pod-5bb4787f8d-7ndj6 80:80
Forwarding from 127.0.0.1:80 -&gt; 8080
Forwarding from [::1]:80 -&gt; 8080
</code></pre></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have something already running locally on port 80, modify the port-forward to an unused port (i.e. 5000:80). <code>port-forward</code> is meant for temporarily exposing an application outside of a Kubernetes cluster. For a more permanent solution, look into Ingress Controllers.</p>
</div>
<p>Finally, we can open a browser and go to <strong>http://127.0.0.1</strong> and should see the following.</p>
<p><img alt="" src="img/welcome-nginx.png" /></p>
<p>You have successfully deployed your first Kubernetes pod. </p>
<p>With the pod running, we can log in and explore the pod. If you don't already, open another shell and run:</p>
<p> <pre><code class=markdown>kubectl exec -it &lt;pod_name&gt; /bin/bash
</code></pre></p>
<p>You can explore the pod and run various commands. Some commands might not be available within the pod. Why would that be?</p>
<p> <pre><code class=markdown>root@first-nginx-pod-5bb4787f8d-7ndj6:/# df -h
Filesystem               Size  Used Avail Use% Mounted on
overlay                   46G  8.0G   38G  18% /
tmpfs                     64M     0   64M   0% /dev
tmpfs                    1.9G     0  1.9G   0% /sys/fs/cgroup
/dev/mapper/centos-root   46G  8.0G   38G  18% /etc/hosts
shm                       64M     0   64M   0% /dev/shm
tmpfs                    1.9G   12K  1.9G   1% /run/secrets/kubernetes.io/serviceaccount
tmpfs                    1.9G     0  1.9G   0% /proc/acpi
tmpfs                    1.9G     0  1.9G   0% /proc/scsi
tmpfs                    1.9G     0  1.9G   0% /sys/firmware

</code></pre></p>
<p>Or modify the webpage:</p>
<p> <pre><code class=markdown>echo Hello from Kubernetes Storage &gt; /usr/share/nginx/html/index.html
</code></pre></p>
<p>Once done, press <strong>Ctrl-D</strong> to exit the pod. Use <strong>Ctrl+C</strong> to exit the port-forwarding.</p>
<hr />
<h2 id="lab_4_install_the_csi_driver">Lab 4: Install the CSI driver<a class="headerlink" href="#lab_4_install_the_csi_driver" title="Permanent link">&para;</a></h2>
<p>To get started with the deployment, the HPE CSI Driver is deployed using industry standard means, either a Helm chart or an Operator. For this tutorial, we will be using Helm to the deploy the HPE CSI driver.</p>
<p>The official Helm chart for the HPE CSI Driver for Kubernetes is hosted on <a href="https://artifacthub.io/packages/helm/hpe-storage/hpe-csi-driver">Artifact Hub</a>. There, you will find the configuration and installation instructions for the chart.</p>
<h3 id="installing_the_chart">Installing the chart<a class="headerlink" href="#installing_the_chart" title="Permanent link">&para;</a></h3>
<p>To install the chart with the name hpe-csi, add the HPE CSI Driver for Kubernetes helm repo.</p>
<p> <pre><code class=markdown>helm repo add hpe https://hpe-storage.github.io/co-deployments
helm repo update
</code></pre></p>
<p>Install the latest chart:</p>
<p> <pre><code class=markdown>helm install hpe-csi hpe/hpe-csi-driver --namespace kube-system
</code></pre></p>
<p>Wait a few minutes as the deployment finishes.</p>
<p>Verify that everything is up and running correctly with the listing out the pods.</p>
<p> <pre><code class=markdown>kubectl get pods --all-namespaces -l 'app in (nimble-csp, primera3par-csp, hpe-csi-node, hpe-csi-controller)'
</code></pre></p>
<p>The output is similar to this:</p>
<p> <pre><code class=markdown>$ kubectl get pods --all-namespaces -l 'app in (nimble-csp, primera3par-csp, hpe-csi-node, hpe-csi-controller)'
NAMESPACE     NAME                                  READY     STATUS    RESTARTS   AGE
kube-system   csp-service-5df8679cf7-m4jcw          1/1       Running   0          5m
kube-system   hpe-csi-controller-84d8569476-9pk74   5/5       Running   0          5m
kube-system   hpe-csi-node-qt74m                    2/2       Running   0          5m
kube-system   primera3par-csp-66f775b555-sfmnp      1/1       Running   0          5m
</code></pre></p>
<p>If all of the components show in Running state, then the HPE CSI driver for Kubernetes and the corresponding Container Storage Providers have been successfully deployed.</p>
<h3 id="creating_a_secret">Creating a Secret<a class="headerlink" href="#creating_a_secret" title="Permanent link">&para;</a></h3>
<p>When the HPE CSI Driver is deployed using the Helm chart or Operator, a <code>Secret</code> needs to be created based upon the backend type (<strong>nimble</strong> or <strong>primera3par</strong> ), backend IP, and credentials. This <code>Secret</code> is used by the CSI sidecars in the <code>StorageClass</code> to authenticate to a specific backend for CSI operations. In order to add a new <code>Secret</code> or manage access to multiple backends, additional <code>Secrets</code> will need to be created per backend.  </p>
<div class="admonition note">
<p class="admonition-title">Secret Requirements</p>
<ul>
<li>Each <code>Secret</code> name must be unique.</li>
<li><strong>servicePort</strong> should be set to <strong>8080</strong>.</li>
</ul>
</div>
<p>Create a new <code>Secret</code>, specify the name, <code>Namespace</code>, backend username, backend password, and the backend IP address to be used by the CSP.</p>
<p> <pre><code class=markdown>kubectl create -f-
</code></pre></p>
<p>Copy and paste the following:</p>
<div class=md-fenced-code-tabs id=tab-tab-group-33><input name=tab-group-33 type=radio id=tab-group-33-0_markdown checked=checked class=code-tab data-lang=markdown aria-controls=tab-group-33-0_markdown-panel role=tab><label for=tab-group-33-0_markdown class=code-tab-label data-lang=markdown id=tab-group-33-0_markdown-label>HPE Nimble Storage</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-33-0_markdown-panel aria-labelledby=tab-group-33-0_markdown-label><pre><code class=markdown>apiVersion: v1
kind: Secret
metadata:
  name: custom-secret
  namespace: kube-system 
stringData:
  serviceName: nimble-csp-svc
  servicePort: &quot;8080&quot;
  backend: 192.168.1.2
  username: admin
data:
  # echo -n &quot;admin&quot; | base64
  password: YWRtaW4=
</code></pre></div><input name=tab-group-33 type=radio id=tab-group-33-1_markdown class=code-tab data-lang=markdown aria-controls=tab-group-33-1_markdown-panel role=tab><label for=tab-group-33-1_markdown class=code-tab-label data-lang=markdown id=tab-group-33-1_markdown-label>HPE Primera</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-33-1_markdown-panel aria-labelledby=tab-group-33-1_markdown-label><pre><code class=markdown>apiVersion: v1
kind: Secret
metadata:
  name: custom-secret
  namespace: kube-system 
stringData:
  serviceName: primera3par-csp-svc 
  servicePort: &quot;8080&quot;
  backend: 10.10.0.2
  username: 3paradm
data:
  # echo -n &quot;3pardata&quot; | base64
  password: M3BhcmRhdGE=
</code></pre></div></div>
<p>Press <strong>Enter</strong> and <strong>Ctrl-D</strong>.</p>
<p>Now let's look at the available StorageClasses.</p>
<p>You should now see the <code>Secret</code> in the "kube-system" <code>Namespace</code>:</p>
<p> <pre><code class=markdown>kubectl -n kube-system get secret/custom-secret
NAME                     TYPE          DATA      AGE
custom-secret            Opaque        5         1m
</code></pre></p>
<h3 id="creating_a_storageclass">Creating a StorageClass<a class="headerlink" href="#creating_a_storageclass" title="Permanent link">&para;</a></h3>
<p>Now we will create a <code>StorageClass</code> that will be used in the following exercises. A <code>StorageClass</code> specifies the provisioner to use (in our case the HPE CSI Driver) and the volume parameters (such as Protection Templates, Performance Policies, CPG, etc.) of the volume that we want to create and can be used to differentiate between storage levels and usages. </p>
<p>This concept is sometimes called “profiles” in other storage systems. A cluster can have multiple <code>StorageClasses</code> allowing users to create storage claims tailored for their specific application requirements.</p>
<p>Create an <strong>hpe-standard</strong> <code>StorageClass</code> based upon the CSP deployed. This <code>StorageClass</code> example will use the <strong>custom-secret</strong> we created in the previous step, if you used a different name make sure to modify the <code>StorageClass</code> accordingly.</p>
<p> <pre><code class=markdown>kubectl create -f-
</code></pre></p>
<p>Copy and paste the following:</p>
<div class=md-fenced-code-tabs id=tab-tab-group-36><input name=tab-group-36 type=radio id=tab-group-36-0_markdown checked=checked class=code-tab data-lang=markdown aria-controls=tab-group-36-0_markdown-panel role=tab><label for=tab-group-36-0_markdown class=code-tab-label data-lang=markdown id=tab-group-36-0_markdown-label>HPE Nimble Storage</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-36-0_markdown-panel aria-labelledby=tab-group-36-0_markdown-label><pre><code class=markdown>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: hpe-standard
  annotations:
    storageclass.kubernetes.io/is-default-class: &quot;true&quot;
provisioner: csi.hpe.com
parameters:
  csi.storage.k8s.io/fstype: xfs
  csi.storage.k8s.io/provisioner-secret-name: custom-secret
  csi.storage.k8s.io/provisioner-secret-namespace: kube-system
  csi.storage.k8s.io/controller-publish-secret-name: custom-secret
  csi.storage.k8s.io/controller-publish-secret-namespace: kube-system
  csi.storage.k8s.io/node-stage-secret-name: custom-secret
  csi.storage.k8s.io/node-stage-secret-namespace: kube-system
  csi.storage.k8s.io/node-publish-secret-name: custom-secret
  csi.storage.k8s.io/node-publish-secret-namespace: kube-system
  csi.storage.k8s.io/controller-expand-secret-name: custom-secret
  csi.storage.k8s.io/controller-expand-secret-namespace: kube-system
  performancePolicy: &quot;SQL Server&quot;
  description: &quot;Volume from HPE CSI Driver&quot;
  accessProtocol: iscsi
  limitIops: &quot;76800&quot;
  allowOverrides: description,limitIops,performancePolicy
allowVolumeExpansion: true
</code></pre></div><input name=tab-group-36 type=radio id=tab-group-36-1_markdown class=code-tab data-lang=markdown aria-controls=tab-group-36-1_markdown-panel role=tab><label for=tab-group-36-1_markdown class=code-tab-label data-lang=markdown id=tab-group-36-1_markdown-label>HPE 3PAR and Primera</label><div class=code-tabpanel role=tabpanel data-lang=markdown id=tab-group-36-1_markdown-panel aria-labelledby=tab-group-36-1_markdown-label><pre><code class=markdown>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: hpe-standard
  annotations:
    storageclass.kubernetes.io/is-default-class: &quot;true&quot;
provisioner: csi.hpe.com
parameters:
  csi.storage.k8s.io/fstype: ext4
  csi.storage.k8s.io/provisioner-secret-name: custom-secret
  csi.storage.k8s.io/provisioner-secret-namespace: kube-system
  csi.storage.k8s.io/controller-publish-secret-name: custom-secret
  csi.storage.k8s.io/controller-publish-secret-namespace: kube-system
  csi.storage.k8s.io/node-stage-secret-name: custom-secret
  csi.storage.k8s.io/node-stage-secret-namespace: kube-system
  csi.storage.k8s.io/node-publish-secret-name: custom-secret
  csi.storage.k8s.io/node-publish-secret-namespace: kube-system
  csi.storage.k8s.io/controller-expand-secret-name: custom-secret
  csi.storage.k8s.io/controller-expand-secret-namespace: kube-system
  cpg: SSD_r6
  provisioning_type: tpvv
  accessProtocol: iscsi
  allowOverrides: cpg,provisioning_type
allowVolumeExpansion: true
</code></pre></div></div>
<p>Press <strong>Enter</strong> and <strong>Ctrl-D</strong>.</p>
<p>Now let's look at the available StorageClasses.</p>
<p> <pre><code class=markdown>$ kubectl get sc
NAME                     PROVISIONER   AGE
hpe-standard (default)   csi.hpe.com   2m
</code></pre></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We set <strong>hpe-standard</strong> <code>StorageClass</code> as default using the annotation <code>storageclass.kubernetes.io/is-default-class: "true"</code>. To learn more about configuring a default <code>StorageClass</code>, see <a href="https://kubernetes.io/docs/tasks/administer-cluster/change-default-storage-class/">Default StorageClass</a> on kubernetes.io.</p>
</div>
<h3 id="creating_a_persistentvolumeclaim">Creating a PersistentVolumeClaim<a class="headerlink" href="#creating_a_persistentvolumeclaim" title="Permanent link">&para;</a></h3>
<p>With a <code>StorageClass</code> available, we can create a <code>PVC</code> to request an amount of storage for our application.</p>
<p> <pre><code class=markdown>kubectl create -f-
</code></pre></p>
<p>Copy and paste the following:</p>
<p> <pre><code class=markdown>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 50Gi
</code></pre></p>
<p>Press <strong>Enter</strong> and <strong>Ctrl-D</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We can use <code>storageClassName</code> to override the default <code>StorageClass</code> with another available <code>StorageClass</code>.</p>
</div>
<p>We can see the <strong>my-pvc</strong> <code>PersistentVolumeClaim</code> created.</p>
<p> <pre><code class=markdown>kubectl get pvc
NAME                          STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
my-pvc                        Bound    pvc-70d5caf8-7558-40e6-a8b7-77dfcf8ddcd8   50Gi       RWO            hpe-standard   72m
</code></pre></p>
<p>We can inspect the <code>PVC</code> further for additional information.</p>
<p> <pre><code class=markdown>kubectl describe pvc my-pvc
</code></pre></p>
<p>The output is similar to this:</p>
<p> <pre><code class=markdown>$ kubectl describe pvc my-pvc
Name:          my-pvc
Namespace:     default
StorageClass:  hpe-standard
Status:        Bound
Volume:        pvc-70d5caf8-7558-40e6-a8b7-77dfcf8ddcd8
Labels:        &lt;none&gt;
Annotations:   pv.kubernetes.io/bind-completed: yes
               pv.kubernetes.io/bound-by-controller: yes
               volume.beta.kubernetes.io/storage-provisioner: csi.hpe.com
Finalizers:    [kubernetes.io/pvc-protection]
Capacity:      50Gi
Access Modes:  RWO
VolumeMode:    Filesystem
Mounted By:    &lt;none&gt;
Events:        &lt;none&gt;
</code></pre></p>
<p>We can also inspect the volume in a similar manner.</p>
<p> <pre><code class=markdown>kubectl describe pv &lt;volume_name&gt;
</code></pre></p>
<p>The output is similar to this:</p>
<p> <pre><code class=markdown>$ kubectl describe pv pvc-70d5caf8-7558-40e6-a8b7-77dfcf8ddcd8
Name:            pvc-70d5caf8-7558-40e6-a8b7-77dfcf8ddcd8
Labels:          &lt;none&gt;
Annotations:     pv.kubernetes.io/provisioned-by: csi.hpe.com
Finalizers:      [kubernetes.io/pv-protection]
StorageClass:    hpe-standard
Status:          Bound
Claim:           default/my-pvc
Reclaim Policy:  Delete
Access Modes:    RWO
VolumeMode:      Filesystem
Capacity:        50Gi
Node Affinity:   &lt;none&gt;
Message:
Source:
    Type:              CSI (a Container Storage Interface (CSI) volume source)
    Driver:            csi.hpe.com
    VolumeHandle:      063aba3d50ec99d866000000000000000000000001
    ReadOnly:          false
    VolumeAttributes:      accessProtocol=iscsi
                           allowOverrides=description,limitIops,performancePolicy
                           description=Volume from HPE CSI Driver
                           fsType=xfs
                           limitIops=76800
                           performancePolicy=SQL Server
                           storage.kubernetes.io/csiProvisionerIdentity=1583271972595-8081-csi.hpe.com
                           volumeAccessMode=mount
Events:                &lt;none&gt;
</code></pre></p>
<p>With the <code>describe</code> command, you can see the volume parameters applied to the volume.</p>
<p>Let's recap what we have learned.</p>
<ol>
<li>We created a default <code>StorageClass</code> for our volumes.</li>
<li>We created a <code>PVC</code> that created a volume from the storageClass.</li>
<li>We can use <strong>kubectl get</strong> to list the <code>StorageClass</code>, <code>PVC</code> and <code>PV</code>.</li>
<li>We can use <strong>kubectl describe</strong> to get details on the <code>StorageClass</code>, <code>PVC</code> or <code>PV</code></li>
</ol>
<p>At this point, we have validated the deployment of the HPE CSI Driver and are ready to deploy an application with persistent storage.</p>
<hr />
<h2 id="lab_5_deploying_wordpress">Lab 5: Deploying Wordpress<a class="headerlink" href="#lab_5_deploying_wordpress" title="Permanent link">&para;</a></h2>
<p>To begin, we will be using the <strong>hpe-standard</strong> <code>StorageClass</code> we created previously. If you don't have <strong>hpe-standard</strong> available, please refer to <a href="#creating_a_storageclass">StorageClass</a> for instructions on creating a <code>StorageClass</code>.</p>
<p>Create a <code>PersistentVolumeClaim</code> for MariaDB for use by Wordpress. This object creates a <code>PersistentVolume</code> as defined, make sure to reference the correct <code>.spec.storageClassName</code>.</p>
<p> <pre><code class=markdown>kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: data-my-wordpress-mariadb-0
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 50Gi
  storageClassName: hpe-standard
</code></pre></p>
<p>Next let's make another for the Wordpress application.</p>
<p> <pre><code class=markdown>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-wordpress
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
  storageClassName: hpe-standard
</code></pre></p>
<p>Let's again verify the <code>PersistentVolume</code> were created successfully.</p>
<p> <pre><code class=markdown>kubectl get pv
NAME                          STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
data-my-wordpress-mariadb-0   Bound     pvc-1abdb7d7-374e-45b3-8fa1-534131ec7ec6   50Gi       RWO            hpe-standard   1m
my-wordpress                  Bound     pvc-ff6dc8fd-2b14-4726-b608-be8b27485603   20Gi       RWO            hpe-standard   1m
</code></pre></p>
<p>The above output means that the HPE CSI Driver successfully provisioned a new volume based upon the <strong>hpe-standard</strong> <code>StorageClass</code>. The volume is not attached to any node yet. It will only be attached to a node once a scheduled workload requests the <code>PersistentVolumeClaim</code>. </p>
<p>Now, let's use Helm to deploy Wordpress using the <code>PVC</code> created previously. When Wordpress is deployed, the volumes will be attached, formatted and mounted.</p>
<p>The first step is to add the Wordpress chart.</p>
<p> <pre><code class=markdown>helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
helm search repo bitnami/wordpress
NAME                    CHART VERSION   APP VERSION     DESCRIPTION
bitnami/wordpress       9.2.1           5.4.0           Web publishing platform for building blogs and ...
</code></pre></p>
<p>Deploy Wordpress by setting <code>persistence.existingClaim=&lt;existing_PVC&gt;</code> to the <code>PVC</code> <strong>my-wordpress</strong> created in the previous step.</p>
<p> <pre><code class=markdown>helm install my-wordpress bitnami/wordpress --version 9.2.1 --set service.type=ClusterIP,wordpressUsername=admin,wordpressPassword=adminpassword,mariadb.mariadbRootPassword=secretpassword,persistence.existingClaim=my-wordpress,allowEmptyPassword=false
</code></pre></p>
<p>Check to verify that Wordpress and MariaDB were deployed and are in the <strong>Running</strong> state. This may take a few minutes.</p>
<p> <pre><code class=markdown>kubectl get pods
NAME                            READY     STATUS    RESTARTS   AGE
my-wordpress-69b7976c85-9mfjv   1/1       Running   0          2m
my-wordpress-mariadb-0          1/1       Running   0          2m
</code></pre></p>
<p>Finally let's take a look at the Wordpress site. You can use <code>kubectl port-forward</code> to access the Wordpress application from within the Kubernetes cluster to verify everything is working correctly.</p>
<p> <pre><code class=markdown>kubectl port-forward svc/my-wordpress 80:80
Forwarding from 127.0.0.1:80 -&gt; 8080
Forwarding from [::1]:80 -&gt; 8080
</code></pre></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have something already running locally on port 80, modify the port-forward to an unused port (i.e. 5000:80).</p>
</div>
<p>Open a browser on your workstation to <strong>http://127.0.0.1</strong> and you should see, <strong>"Hello World!"</strong>.</p>
<p>Access the admin console at: <strong>http://127.0.0.1/admin</strong> using the <strong>"admin/adminpassword"</strong> used to deploy the Helm Chart. </p>
<p><img alt="" src="img/wordpress.png" /></p>
<p><strong>Happy Blogging!</strong></p>
<p>This completes the tutorial of using the HPE CSI Driver with HPE storage to create Persistent Volumes within Kubernetes. This is just the beginning of the capabilities of the HPE Storage integrations within Kubernetes. We recommend exploring <a href="https://scod.hpedev.io">SCOD</a> further and the specific HPE Storage CSP (<a href="http://scod.hpedev.io/container_storage_provider/hpe_nimble_storage/index.html">Nimble</a>, <a href="http://scod.hpedev.io/container_storage_provider/hpe_3par_primera/index.html">Primera, and 3PAR</a>) to learn more.</p>
              
            </div>
          </div>

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../introduction_to_containers/index.html" class="btn btn-neutral float-right" title="For HPE partners:<br />&nbsp;&nbsp; Introduction to Containers">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../containers101/index.html" class="btn btn-neutral" title="Cloud-Native, Containers & DevOps"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
    <p>Copyright 2020 Hewlett Packard Enterprise Development LP<br />Give <a href="https://github.com/hpe-storage/scod/issues/new?title=learn/persistent_storage/index.html">feedback</a> on this page.</p>
    
  </div>
</footer>

        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../containers101/index.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../introduction_to_containers/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
